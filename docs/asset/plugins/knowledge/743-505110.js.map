{"version":3,"file":"743-505110.js","mappings":"u6BAIc,SAAUA,EAAQC,GAA4C,IAAzCC,EAAQD,EAARC,SACzBC,GAAKC,EAAAA,EAAAA,kBAqDX,OAnDAC,EAAAA,EAAAA,YAAU,WAEN,IAAMC,EAAuE,SAA/DC,GAA8E,IAAZC,EAAMD,EAANC,OAC5EA,EAAOC,OAAOC,WAAUC,EAAAA,EAAA,GACjBH,EAAOC,OAAOC,YAAU,IAC3BE,UAAW,CACPC,MAAO,OACPC,KAAM,YAIdN,EAAOO,SAAQJ,EAAAA,EAAA,GACRH,EAAOO,UAAQ,IAClBH,UAAW,CACP,UAAW,yCACX,aAAc,CACVI,OAAQ,YACRC,YAAa,WACPC,SAAQ,SAACC,GAA0C,OAAAC,IAAAC,IAAAA,MAAA,SAAAC,IAAA,IAAAC,EAAAC,EAAAC,EAAA,OAAAJ,IAAAA,MAAA,SAAAK,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OACzB,GAAtBL,GAAUM,EAAAA,EAAAA,OACZV,EAAOW,MAAO,CAAFJ,EAAAE,KAAA,eAAAF,EAAAE,KAAA,EACQL,EAAQQ,SAASZ,EAAOW,OAAM,OAAvC,OAALN,EAAKE,EAAAM,KAAAN,EAAAO,OAAA,SAEJT,EAAMU,KAAI,SAACT,GACd,MAAO,CACHU,MAAOV,EAAKW,QACZC,MAAOZ,EAAKa,KAEpB,KAAE,WAEFnB,EAAOgB,MAAO,CAAFT,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,EACOL,EAAQgB,QAAQpB,EAAOgB,OAAM,OAAtC,KAAJV,EAAIC,EAAAM,MACA,CAAFN,EAAAE,KAAA,gBAAAF,EAAAO,OAAA,SACG,CACH,CACIE,MAAOV,EAAKW,QACZC,MAAOZ,EAAKa,QAEnB,yBAAAZ,EAAAc,OAAA,GAAAlB,EAAA,IApB4CF,EAuBzD,KAIhB,EAEAjB,EAAGsC,iBAAiB,mBAAoBnC,GACxCH,EAAGsC,iBAAiB,mBAAoBnC,EAC5C,GAAG,IAEIJ,CACX,C","sources":["webpack://TopWritePlugins.knowledge/./src/components/editor/activate.tsx"],"sourcesContent":["import { GetComponentProps, useEventTarget } from 'topwrite';\r\nimport { useEffect } from 'react';\r\nimport { useSubBook } from '@/lib/sub-book';\r\n\r\nexport default function Activate({ children }: GetComponentProps<'activate'>) {\r\n    const et = useEventTarget();\r\n\r\n    useEffect(() => {\r\n\r\n        const listener: TypeEventListener<'beforeCreatePart' | 'beforeUpdatePart'> = ({ detail }) => {\r\n            detail.schema.properties = {\r\n                ...detail.schema.properties,\r\n                reference: {\r\n                    title: '关联文档',\r\n                    type: 'string',\r\n                }\r\n            };\r\n\r\n            detail.uiSchema = {\r\n                ...detail.uiSchema,\r\n                reference: {\r\n                    'ui:help': '关联文档后该分组下的章节替换为被关联文档的所有章节，只能关联已发布的公开文档',\r\n                    'ui:options': {\r\n                        widget: 'typeahead',\r\n                        placeholder: '输入文档名称搜索',\r\n                        async onSearch(params: { query?: string, value?: string }) {\r\n                            const subBook = useSubBook();\r\n                            if (params.query) {\r\n                                const books = await subBook.getBooks(params.query);\r\n\r\n                                return books.map((book) => {\r\n                                    return {\r\n                                        value: book.hash_id,\r\n                                        label: book.name\r\n                                    };\r\n                                });\r\n                            }\r\n                            if (params.value) {\r\n                                const book = await subBook.getBook(params.value);\r\n                                if (book) {\r\n                                    return [\r\n                                        {\r\n                                            value: book.hash_id,\r\n                                            label: book.name\r\n                                        }\r\n                                    ];\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        };\r\n\r\n        et.addEventListener('beforeCreatePart', listener);\r\n        et.addEventListener('beforeUpdatePart', listener);\r\n    }, []);\r\n\r\n    return children;\r\n}\r\n"],"names":["Activate","_ref","children","et","useEventTarget","useEffect","listener","_ref2","detail","schema","properties","_objectSpread","reference","title","type","uiSchema","widget","placeholder","onSearch","params","_asyncToGenerator","_regeneratorRuntime","_callee","subBook","books","book","_context","prev","next","useSubBook","query","getBooks","sent","abrupt","map","value","hash_id","label","name","getBook","stop","addEventListener"],"sourceRoot":""}